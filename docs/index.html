<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>az-loadenv</title>
  <meta name="description" content="Export Azure Web App settings to a .env file with automatic Key Vault secret resolution.">
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            border: 'hsl(214.3 31.8% 91.4%)',
            ring: 'hsl(222.2 84% 4.9%)',
            background: 'hsl(0 0% 100%)',
            foreground: 'hsl(222.2 84% 4.9%)',
            primary: { DEFAULT: 'hsl(222.2 47.4% 11.2%)', foreground: 'hsl(210 40% 98%)' },
            muted: { DEFAULT: 'hsl(210 40% 96.1%)', foreground: 'hsl(215.4 16.3% 46.9%)' },
            accent: { DEFAULT: 'hsl(210 40% 96.1%)', foreground: 'hsl(222.2 47.4% 11.2%)' },
            sidebar: { DEFAULT: 'hsl(0 0% 98%)', foreground: 'hsl(240 5.3% 26.1%)', accent: 'hsl(240 4.8% 95.9%)' }
          },
          fontFamily: {
            sans: ['"Inter"', 'system-ui', '-apple-system', 'sans-serif'],
            mono: ['"JetBrains Mono"', '"Fira Code"', 'monospace']
          }
        }
      }
    }
  </script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11/styles/github.min.css">
  <script src="https://cdn.jsdelivr.net/npm/highlight.js@11/highlight.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/highlight.js@11/languages/bash.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/highlight.js@11/languages/go.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/highlight.js@11/languages/yaml.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/highlight.js@11/languages/ruby.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/highlight.js@11/languages/powershell.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/highlight.js@11/languages/dockerfile.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/marked@14/marked.min.js"></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html { scroll-behavior: smooth; }
    body { font-family: 'Inter', system-ui, -apple-system, sans-serif; background: #fff; color: hsl(222.2 84% 4.9%); }

    /* Markdown content styles */
    .prose { max-width: 48rem; line-height: 1.75; }
    .prose h1 { font-size: 2rem; font-weight: 700; margin-top: 0; margin-bottom: 1rem; letter-spacing: -0.025em; border-bottom: 1px solid hsl(214.3 31.8% 91.4%); padding-bottom: 0.75rem; }
    .prose h2 { font-size: 1.5rem; font-weight: 600; margin-top: 2.5rem; margin-bottom: 0.75rem; letter-spacing: -0.02em; }
    .prose h3 { font-size: 1.25rem; font-weight: 600; margin-top: 2rem; margin-bottom: 0.5rem; }
    .prose p { margin-bottom: 1rem; color: hsl(215.4 16.3% 46.9%); }
    .prose a { color: hsl(222.2 47.4% 11.2%); text-decoration: underline; text-underline-offset: 4px; }
    .prose a:hover { color: hsl(222.2 47.4% 25%); }
    .prose strong { font-weight: 600; color: hsl(222.2 84% 4.9%); }
    .prose ul, .prose ol { margin-bottom: 1rem; padding-left: 1.5rem; color: hsl(215.4 16.3% 46.9%); }
    .prose li { margin-bottom: 0.375rem; }
    .prose li > ul, .prose li > ol { margin-top: 0.375rem; margin-bottom: 0; }
    .prose blockquote { border-left: 3px solid hsl(214.3 31.8% 91.4%); padding-left: 1rem; margin-bottom: 1rem; color: hsl(215.4 16.3% 46.9%); font-style: italic; }
    .prose code { font-family: 'JetBrains Mono', 'Fira Code', monospace; font-size: 0.875em; background: hsl(210 40% 96.1%); padding: 0.15em 0.4em; border-radius: 0.375rem; font-weight: 500; }
    .prose pre { margin-bottom: 1.25rem; border-radius: 0.75rem; border: 1px solid hsl(214.3 31.8% 91.4%); overflow: hidden; }
    .prose pre code { display: block; padding: 1rem 1.25rem; background: hsl(0 0% 98%); font-size: 0.8125rem; line-height: 1.7; overflow-x: auto; }
    .prose table { width: 100%; border-collapse: collapse; margin-bottom: 1.25rem; font-size: 0.875rem; }
    .prose thead th { text-align: left; font-weight: 600; padding: 0.625rem 1rem; border-bottom: 2px solid hsl(214.3 31.8% 91.4%); color: hsl(222.2 84% 4.9%); }
    .prose tbody td { padding: 0.625rem 1rem; border-bottom: 1px solid hsl(214.3 31.8% 91.4%); color: hsl(215.4 16.3% 46.9%); }
    .prose tbody tr:last-child td { border-bottom: none; }
    .prose hr { border: none; border-top: 1px solid hsl(214.3 31.8% 91.4%); margin: 2rem 0; }

    /* Code block copy button */
    .code-block { position: relative; }
    .copy-btn { position: absolute; top: 0.5rem; right: 0.5rem; padding: 0.25rem 0.625rem; font-size: 0.75rem; font-family: 'Inter', sans-serif; background: hsl(0 0% 100%); border: 1px solid hsl(214.3 31.8% 91.4%); border-radius: 0.375rem; cursor: pointer; color: hsl(215.4 16.3% 46.9%); opacity: 0; transition: opacity 0.15s; }
    .code-block:hover .copy-btn { opacity: 1; }
    .copy-btn:hover { background: hsl(210 40% 96.1%); color: hsl(222.2 84% 4.9%); }

    /* Scrollbar */
    ::-webkit-scrollbar { width: 6px; height: 6px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: hsl(214.3 31.8% 85%); border-radius: 3px; }
    ::-webkit-scrollbar-thumb:hover { background: hsl(214.3 31.8% 70%); }

    /* Mobile menu */
    .menu-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.4); z-index: 40; opacity: 0; pointer-events: none; transition: opacity 0.2s; }
    .menu-overlay.open { opacity: 1; pointer-events: auto; }
    .mobile-sidebar { position: fixed; top: 0; left: 0; bottom: 0; width: 280px; z-index: 50; transform: translateX(-100%); transition: transform 0.2s ease; }
    .mobile-sidebar.open { transform: translateX(0); }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel" data-type="module">
    const { useState, useEffect, useCallback, useRef } = React;

    const NAV = [
      { label: 'Home', path: '' },
      { heading: 'Getting started' },
      { label: 'Installation', path: 'installation' },
      { label: 'Quick start', path: 'quickstart' },
      { heading: 'Usage' },
      { label: 'CLI reference', path: 'cli-reference' },
      { label: 'Output format', path: 'output-format' },
      { label: 'Raw mode', path: 'raw-mode' },
      { heading: 'Azure integration' },
      { label: 'Authentication', path: 'authentication' },
      { label: 'Subscription detection', path: 'subscription-detection' },
      { label: 'Key Vault resolution', path: 'key-vault' },
      { heading: 'Deployment' },
      { label: 'CI/CD pipelines', path: 'ci-cd' },
      { label: 'Building from source', path: 'building' },
      { label: 'Releases', path: 'releases' },
      { heading: '' },
      { label: 'Troubleshooting', path: 'troubleshooting' },
    ];

    function getPath() {
      return (window.location.hash || '#/').replace('#/', '').replace(/\/$/, '');
    }

    function useRoute() {
      const [path, setPath] = useState(getPath());
      useEffect(() => {
        const handler = () => setPath(getPath());
        window.addEventListener('hashchange', handler);
        return () => window.removeEventListener('hashchange', handler);
      }, []);
      return path;
    }

    function renderMarkdown(md) {
      return Promise.resolve(marked.parse(md, { gfm: true }));
    }

    function enhanceCodeBlocks(container) {
      if (!container) return;
      container.querySelectorAll('pre code').forEach(block => {
        hljs.highlightElement(block);
        const wrapper = block.closest('pre');
        if (wrapper && !wrapper.parentElement.classList.contains('code-block')) {
          const div = document.createElement('div');
          div.className = 'code-block';
          wrapper.parentNode.insertBefore(div, wrapper);
          div.appendChild(wrapper);
          const btn = document.createElement('button');
          btn.className = 'copy-btn';
          btn.textContent = 'Copy';
          btn.onclick = function() { copyCode(btn); };
          div.insertBefore(btn, wrapper);
        }
      });
    }

    function Sidebar({ current, onNavigate, className }) {
      return (
        <nav className={className}>
          <div className="p-4 pb-2">
            <a href="#/" className="flex items-center gap-2 text-sm font-semibold tracking-tight" onClick={onNavigate}>
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <rect width="7" height="7" x="14" y="3" rx="1"/><path d="M10 21V8a1 1 0 0 0-1-1H4a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-5a1 1 0 0 0-1-1H3"/>
              </svg>
              az-loadenv
            </a>
          </div>
          <div className="px-2 py-2 overflow-y-auto" style={{ height: 'calc(100vh - 56px)' }}>
            {NAV.map((item, i) => {
              if (item.heading !== undefined) {
                if (!item.heading) return <div key={i} className="my-2" />;
                return <div key={i} className="px-3 pt-4 pb-1 text-xs font-medium text-muted-foreground uppercase tracking-wider">{item.heading}</div>;
              }
              const active = current === item.path;
              return (
                <a
                  key={i}
                  href={`#/${item.path}`}
                  onClick={onNavigate}
                  className={`block px-3 py-1.5 rounded-md text-sm transition-colors ${
                    active
                      ? 'bg-sidebar-accent text-sidebar-foreground font-medium'
                      : 'text-muted-foreground hover:text-sidebar-foreground hover:bg-sidebar-accent'
                  }`}
                >
                  {item.label}
                </a>
              );
            })}
            <div className="mt-6 px-3 pb-4">
              <a
                href="https://github.com/curiousdev/az-loadenv"
                target="_blank"
                rel="noopener"
                className="flex items-center gap-2 text-xs text-muted-foreground hover:text-sidebar-foreground transition-colors"
              >
                <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0 0 24 12c0-6.63-5.37-12-12-12z"/>
                </svg>
                GitHub
              </a>
            </div>
          </div>
        </nav>
      );
    }

    function Content({ path }) {
      const [html, setHtml] = useState('');
      const [loading, setLoading] = useState(true);
      const contentRef = useRef(null);

      useEffect(() => {
        setLoading(true);
        const file = path === '' ? 'README.md' : `${path}.md`;
        const url = new URL(file, window.location.href.split('#')[0]);
        fetch(url)
          .then(r => {
            if (!r.ok) throw new Error('Not found');
            return r.text();
          })
          .then(md => renderMarkdown(md))
          .then(rendered => {
            setHtml(rendered);
            setLoading(false);
          })
          .catch(() => {
            setHtml('<h1>Page not found</h1><p>The requested page could not be found.</p>');
            setLoading(false);
          });
      }, [path]);

      useEffect(() => {
        if (contentRef.current) {
          contentRef.current.scrollTo(0, 0);
          enhanceCodeBlocks(contentRef.current);
        }
      }, [html]);

      if (loading) {
        return (
          <div className="flex items-center justify-center h-full">
            <div className="animate-pulse text-muted-foreground text-sm">Loading...</div>
          </div>
        );
      }

      return (
        <div ref={contentRef} className="overflow-y-auto h-full">
          <div className="max-w-3xl mx-auto px-6 md:px-8 py-10">
            <article className="prose" dangerouslySetInnerHTML={{ __html: html }} />
          </div>
        </div>
      );
    }

    function App() {
      const path = useRoute();
      const [menuOpen, setMenuOpen] = useState(false);
      const closeMenu = useCallback(() => setMenuOpen(false), []);

      return (
        <div className="h-screen flex">
          {/* Desktop sidebar */}
          <Sidebar
            current={path}
            className="hidden md:block w-64 flex-shrink-0 border-r border-border bg-sidebar"
          />

          {/* Mobile header + sidebar */}
          <div className={`menu-overlay ${menuOpen ? 'open' : ''}`} onClick={closeMenu} />
          <Sidebar
            current={path}
            onNavigate={closeMenu}
            className={`mobile-sidebar md:hidden bg-sidebar border-r border-border ${menuOpen ? 'open' : ''}`}
          />

          <div className="flex-1 flex flex-col min-w-0">
            {/* Mobile top bar */}
            <header className="md:hidden flex items-center gap-3 px-4 py-3 border-b border-border bg-background">
              <button onClick={() => setMenuOpen(true)} className="p-1 rounded-md hover:bg-accent">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                  <line x1="4" x2="20" y1="12" y2="12"/><line x1="4" x2="20" y1="6" y2="6"/><line x1="4" x2="20" y1="18" y2="18"/>
                </svg>
              </button>
              <span className="text-sm font-semibold">az-loadenv</span>
            </header>

            <Content path={path} />
          </div>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);

    // Global copy handler
    window.copyCode = function(btn) {
      const code = btn.parentElement.querySelector('code').textContent;
      navigator.clipboard.writeText(code).then(() => {
        btn.textContent = 'Copied';
        setTimeout(() => btn.textContent = 'Copy', 1500);
      });
    };
  </script>
</body>
</html>
